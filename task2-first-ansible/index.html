
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>Task 2 - First Simple Ansible Playbook - Cisco Live 2021 HOLDCN-1010</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#step-1-using-atom-text-editor" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cisco Live 2021 HOLDCN-1010" class="md-header__button md-logo" aria-label="Cisco Live 2021 HOLDCN-1010" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cisco Live 2021 HOLDCN-1010
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Task 2 - First Simple Ansible Playbook
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/fchaudhr/holdcn-1010.git/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cisco Live 2021 HOLDCN-1010" class="md-nav__button md-logo" aria-label="Cisco Live 2021 HOLDCN-1010" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Cisco Live 2021 HOLDCN-1010
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/fchaudhr/holdcn-1010.git/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task1-ansible-node/" class="md-nav__link">
        Task 1 - Prepare Ansible node
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Task 2 - First Simple Ansible Playbook
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Task 2 - First Simple Ansible Playbook
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-using-atom-text-editor" class="md-nav__link">
    Step 1: Using "Atom" text Editor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-atom-folder" class="md-nav__link">
    Step 2: Atom folder
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-define-variables-tasks-for-playbook" class="md-nav__link">
    Step 3: Define variables, tasks for playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-vlan-tasks-in-playbook" class="md-nav__link">
    Step 4: VLAN tasks in playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-execute-playbook" class="md-nav__link">
    Step 5: Execute playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-server-port-vlan-tasks-in-playbook" class="md-nav__link">
    Step 6: Server port VLAN tasks in playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-execute-playbook" class="md-nav__link">
    Step 7: Execute playbook
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task3-vxlan-jinja2/" class="md-nav__link">
        Task 3 - Use of Jinja2 templates with Ansible Playbook
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task4-vxlan-nxos/" class="md-nav__link">
        Task 4 - Config switches using Ansible NXOS modules
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task5-day2-operation/" class="md-nav__link">
        Task 5 - Day 2 Operations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../appendixA-F5/" class="md-nav__link">
        Appendix A - F5
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../appendixB-Upgrade/" class="md-nav__link">
        Appendix B - Upgrade
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-using-atom-text-editor" class="md-nav__link">
    Step 1: Using "Atom" text Editor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-atom-folder" class="md-nav__link">
    Step 2: Atom folder
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-define-variables-tasks-for-playbook" class="md-nav__link">
    Step 3: Define variables, tasks for playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-vlan-tasks-in-playbook" class="md-nav__link">
    Step 4: VLAN tasks in playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-execute-playbook" class="md-nav__link">
    Step 5: Execute playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-server-port-vlan-tasks-in-playbook" class="md-nav__link">
    Step 6: Server port VLAN tasks in playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-execute-playbook" class="md-nav__link">
    Step 7: Execute playbook
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/fchaudhr/holdcn-1010.git/edit/master/docs/task2-first-ansible.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Task 2 - First Simple Ansible Playbook</h1>
                
                <p>In this section, we will create the first Ansible Playbook. In the playbook, we will configure VLANs on leaf switches, and assign VLANs to the server facing port. </p>
<p>You will learn create variables inside playbook, learn simple loop using “<strong>with_items</strong>”, learn simple logical using “<strong>when</strong>” and learn “<strong>tags</strong>” to isolate tasks from whole playbook. </p>
<hr />
<h3 id="step-1-using-atom-text-editor">Step 1: Using "Atom" text Editor</h3>
<ul>
<li>
<p>Open “Atom” text editor by double click the icon on desktop. Atom is the recommended text editor for this lab:</p>
<p><img alt="" src="../pic/2-1-atom.png" /></p>
</li>
<li>
<p>After opening ATOM, <strong>Click</strong> <code>No, Never</code> to the <strong><em>“Register as default atom:// URI handler”</em></strong> message as show below:</p>
<p><img alt="" src="../pic/2-1-2-atom.png" /></p>
</li>
<li>
<p>As an optional step: on ATOM you may close the Welcome, Welcome Guide, Telemetry Consent tabs. </p>
</li>
</ul>
<hr />
<h3 id="step-2-atom-folder">Step 2: Atom folder</h3>
<ul>
<li>After opening ATOM, there should be a folder in the left pane named “LTRDCN-1572.”</li>
<li>
<p><strong>Right click</strong> the pre-configured project folder <code>LTRDCN-1572</code> and select <code>New File</code> </p>
<p><img alt="" src="../pic/2-2-atom-folder.png" /></p>
</li>
<li>
<p>Name the new file <code>vlan_provision.yml</code> and hit enter. This will create the new file:</p>
<p><img alt="" src="../pic/2-2-2-atom-vlan.png" /></p>
</li>
<li>
<p>Also, on the lower bar of the ATOM, verify that  file grammar of <strong>YAML</strong> is selected instead of default "<strong>Plain Text</strong>".  If <strong>YAML</strong> is not selected, then you should <strong>choose</strong> it from the listed options.</p>
<p><img alt="" src="../pic/2-2-3-atom-yaml.png" /></p>
</li>
</ul>
<hr />
<h3 id="step-3-define-variables-tasks-for-playbook">Step 3: Define variables, tasks for playbook</h3>
<p>In this step, we are going to define the scope, variable for playbook and tasks </p>
<ul>
<li>In the opened window for ‘vlan_provision.yml’ file, enter the below content.<ul>
<li><strong>NOTE: YAML is space sensitive. Hence be careful with the spaces in below section.  You may copy and paste the full content (start to finish) from below to make sure that spaces are copied properly.</strong></li>
</ul>
</li>
</ul>
<pre><code class="language-YAML">---                     
#Task 2: Simple playbook assign VLAN to server facing port
  - hosts: leaf:jinja2_leaf
    vars:
      nxos_provider:
        username: &quot;{{ user }}&quot;
        password: &quot;{{ pwd }}&quot;
        transport: nxapi
        host: &quot;{{ inventory_hostname }}&quot;

</code></pre>
<p>Further note:</p>
<ul>
<li>“<strong>hosts:</strong>” defines the scope of this playbook applies to all switches in group ‘leaf’ and ‘jinja2_leaf’ (within the <strong><em>"hosts"</em></strong> file created in pervious task). <ul>
<li><strong>Note</strong> that you can review the IP addresses of the three (2) “leaf” and one (1) “jinja2_leaf” in the “<strong><em>hosts</em></strong>” file (configured in previous steps).  The IP addresses are:<ul>
<li>jinja2_leaf: 198.18.4.104</li>
<li>leaf: 198.18.4.101</li>
<li>leaf: 198.18.4.103</li>
</ul>
</li>
</ul>
</li>
<li>“<strong>vars</strong>” defines one variable “<strong>nxos_provider</strong>” that will be used in this playbook. </li>
<li>“<strong>nxos_provider</strong>” is variable that includes all value that will be used for connection and autnentication. <ul>
<li>This variable will be referenced in playbook via “<strong>provider</strong>” argument (that will be added in next step #4).    </li>
</ul>
</li>
</ul>
<hr />
<h3 id="step-4-vlan-tasks-in-playbook">Step 4: VLAN tasks in playbook</h3>
<ul>
<li>Continue to add below tasks on the same  playbook file:<ul>
<li><strong>NOTE: YAML is space sensitive. Hence be careful with the spaces in below section.  You may copy and paste the full content (start to finish) from below to make sure that spaces are copied properly.</strong></li>
</ul>
</li>
</ul>
<pre><code class="language-YAML">    tasks:
      - name: provision VLAN
        nxos_config:
          lines: &quot;vlan {{item}}&quot;
          provider: &quot;{{nxos_provider}}&quot;
        with_items:
          -  140
          -  141
        tags: add vlans
</code></pre>
<p>Note:</p>
<ul>
<li>Multiple plays can be defined in one playbook under “<strong>tasks</strong>”, each starts with “-“ . </li>
<li>
<p>This kind of play creates multiple VLANs using <strong>nxos_config</strong> module. </p>
<ul>
<li>The “lines” option is used to pass only one configuration command.  This commands must be the exact same commands as found in the device running-config.</li>
<li>Though one or multiple configuration commands can be configured under the “lines” option.   For multiple, ordered set of commands can be configured under this “line” section.</li>
</ul>
</li>
<li>
<p>At the end of this play, we use “<strong>tags</strong>” to name the play “<strong>add vlans</strong>”. This is useful to run a specific part of the configuration without running whole playbook.</p>
</li>
<li>
<p>Below screenshot shows how playbook will look:</p>
<p><img alt="" src="../pic/2-4-1.png" /></p>
<p><strong>NOTE: Formatting is extremely important when working with Ansible. Ansible playbook would return errors if the spaces are not properly aligned or formatting is not correct
</strong></p>
</li>
<li>
<p><strong>Click</strong> <code>File</code> and <code>Save</code> . This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package. </p>
<p><img alt="" src="../pic/2-4-2.png" /></p>
<p><strong>NOTE: Once the Save button is pressed, then at the lower part of ATOM app, you will see message about connecting to Ansibe host (198.18.134.150) and saving the vlan_provision.yml file</strong></p>
</li>
</ul>
<hr />
<h3 id="step-5-execute-playbook">Step 5: Execute playbook</h3>
<p>After creating the playbook, it is now time to execute the playbook. 
*  Before executing the playbook, we will verify the leaf switch if it has any vlan configuration present on it.
*  <strong>Login</strong> to leaf-3 switch using the Mputty client, or any leaf switch in previous playbook (remember <strong>hosts:</strong> variable in the file), and execute <code>show vlan brief</code> command. 
    *  This command will show the vlans that currently exist on the leaf switch.  As you note from below screenshot, only the default VLAN (vlan number 1) is configured:</p>
<p><img alt="" src="../pic/2-5-1.png" /></p>
<ul>
<li>Now, go to mputty, login or launch a new ssh into Ansible node (198.18.134.150) </li>
<li>
<p>Use command <code>ansible-playbook vlan_provision.yml --tags "add vlans"</code> under folder "LTRDCN-1572" as shown below:</p>
<pre><code>[root@rhel7-tools LTRDCN-1572]# ansible-playbook vlan_provision.yml --tags "add vlans"
</code></pre>
<p><img alt="" src="../pic/2-5-2.png" /></p>
<p><strong>Note: If the playbook fails first time, re-run the playbook again. Make sure to save all the changes in the playbook first before executing the playbook in Ansible.</strong></p>
</li>
<li>
<p>After playbook is run successfully, login into leaf 3 again and check if vlan 140 and vlan 141 appears. There would also be a log message on the screen indicating a configuration change was pushed to the device:</p>
<p><img alt="" src="../pic/2-5-3.png" /></p>
</li>
</ul>
<hr />
<h3 id="step-6-server-port-vlan-tasks-in-playbook">Step 6: Server port VLAN tasks in playbook</h3>
<p>We have just tested our first playbook with basic configuration (i.e, by adding 2 VLANS), now we are going to add more tasks in our existing playbook “<strong>vlan_provision.yml</strong>” in this step:</p>
<ul>
<li>we will add new plays in the playbook to assign VLANs to server facing port. This time, we will configure VLAN towards the server facing ports</li>
<li>Go back to <strong>ATOM</strong> and <strong>add</strong> the following plays to the <strong>existing playbook</strong><ul>
<li><em>NOTE: YAML is space sensitive. Hence be careful with the spaces in below section.  You may copy and paste the full content (start to finish) from below to make sure that spaces are copied properly.</em></li>
</ul>
</li>
</ul>
<pre><code class="language-YAML">      - name: configure server facing port to L2
        nxos_interface:
          interface: eth1/3
          mode: layer2
          provider: &quot;{{nxos_provider}}&quot;
      - name: configure VLAN for server port
        when: (&quot;101&quot; in inventory_hostname) or (&quot;103&quot; in inventory_hostname)
        nxos_switchport:
          interface: eth1/3
          mode: access
          access_vlan: 140
          provider: &quot;{{nxos_provider}}&quot;
      - name: configure VLAN for server port
        when: (&quot;102&quot; in inventory_hostname) or (&quot;104&quot; in inventory_hostname)
        nxos_switchport:
          interface: eth1/3
          mode: access
          access_vlan: 141
          provider: &quot;{{nxos_provider}}&quot;
</code></pre>
<ul>
<li><strong>Click</strong> <code>File</code> and <code>Save</code> on ATOM. This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package. </li>
</ul>
<p>Note: In this new play, we used nxos module “<strong>nxos_interface</strong>” and “<strong>nxos_switchport</strong>”. </p>
<ul>
<li>“<strong>nxos_interface</strong>” provides the capability to manage the physical attributes of an interface<ul>
<li>In this example, it is used to configure “layer 2” on interface Ethernet 1/3</li>
</ul>
</li>
<li>“<strong>nxos_switchport</strong>” provides the capability to manage the Layer 2 switchport attributes<ul>
<li>In this example, it is used to configuration it is used to configure mode access on Ethernet ports 1/3</li>
</ul>
</li>
<li>We used “<strong>when</strong>” argument to provide little logic of the play. <ul>
<li>In our example, the playbook assign VLAN 140 on leaf1 and leaf3 switches; assign VLAN 141 on leaf4 switch. </li>
</ul>
</li>
</ul>
<hr />
<h3 id="step-7-execute-playbook">Step 7: Execute playbook</h3>
<p>Now, we are going to execute this playbook:</p>
<ul>
<li>Before excuting the ansible playbook, you may log into switch (leaf1, leaf3 or leaf4) using MTPutty client, and check the existing configuration by executing the below command:</li>
</ul>
<pre><code>show run interface ethernet1/3
</code></pre>
<ul>
<li>
<p>On MTPuttY, log back into (or launch a new ssh) into “Ansible” node</p>
</li>
<li>
<p>Execute command <code>ansible-playbook vlan_provision.yml</code> in the “LTRDCN-1572” directory as shown below:</p>
</li>
</ul>
<pre><code>[root@rhel7-tools LTRDCN-1572]# ansible-playbook vlan_provision.yml
</code></pre>
<p>Below screeenshot shows the execution of above command:</p>
<p><img alt="" src="../pic/2-7-1-new.png" /></p>
<ul>
<li>After we push the configuration, <strong>login</strong> to the <strong>leaf-3</strong> switch, and check if the server facing port has the access vlan configured with the below command:</li>
</ul>
<pre><code>show run interface ethernet1/3
</code></pre>
<p>The output of above command on leaf-3 or leaf-1 is shown in below screenshot:</p>
<p><img alt="" src="../pic/2-7-2.png" /></p>
<p>The output of above command on leaf-4 is shown in below screenshot:</p>
<p><img alt="" src="../pic/2-7-3.png" /></p>
<hr />
<p><strong>Congratulation! You have created your first ansible playbook, automatically provisioned new VLANs and assigned port to new created VLANs using Ansible. Next we are going to create VXLAN Fabric using Ansible. 
</strong></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../Task1-ansible-node/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Task 1 - Prepare Ansible node" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Task 1 - Prepare Ansible node
            </div>
          </div>
        </a>
      
      
        
        <a href="../task3-vxlan-jinja2/" class="md-footer__link md-footer__link--next" aria-label="Next: Task 3 - Use of Jinja2 templates with Ansible Playbook" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Task 3 - Use of Jinja2 templates with Ansible Playbook
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>